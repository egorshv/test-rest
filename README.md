# Справочник организаций (FastAPI)

REST API для каталога организаций, зданий и видов деятельности. Проект построен на стеке FastAPI + SQLAlchemy + Alembic с документированием через встроенный Swagger UI (`/docs`).

## Возможности
- API-ключ через заголовок `X-API-Key` (значение настраивается переменной `API_KEY`)
- Каталог зданий с координатами
- Иерархический (до 3 уровней) справочник видов деятельности
- Организации с несколькими телефонами, привязкой к зданию и видам деятельности
- Поиск организаций:
  - в конкретном здании
  - по виду деятельности с учётом всех дочерних видов
  - по названию
  - в радиусе/прямоугольной области относительно точки
- Просмотр дерева видов деятельности

## Быстрый старт (локально)
1. Создайте и активируйте виртуальное окружение Python 3.11+
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Скопируйте пример настроек:
   ```bash
   cp .env.example .env
   # При необходимости поправьте DATABASE_URL и API_KEY
   ```
4. Примените миграции и заполните базу тестовыми данными:
   ```bash
   alembic upgrade head
   python scripts/seed_data.py
   ```
5. Запустите приложение:
   ```bash
   uvicorn app.main:app --reload
   ```
6. Откройте Swagger UI: http://127.0.0.1:8000/docs (не забудьте передавать `X-API-Key` в запросах).

## Docker
```bash
docker compose up --build
```
Команда выполнит миграции и наполнит базу при старте контейнера. Значения по умолчанию:
- порт `8000`
- база `sqlite:///app.db`
- API-ключ `secret-api-key` (переопределите через переменные окружения при необходимости).

## Основные эндпоинты (`/api`)
- `GET /buildings` – список зданий
- `GET /buildings/{id}/organizations` – организации внутри заданного здания
- `GET /activities` – дерево видов деятельности
- `GET /activities/{id}/organizations` – организации по виду деятельности (учитываются дочерние)
- `GET /activities/search/organizations?name=Еда` – поиск организаций по названию вида деятельности
- `GET /organizations/{id}` – карточка организации
- `GET /organizations/search?query=Рога` – поиск по части названия
- `GET /organizations/nearby?latitude=...&longitude=...&radius_km=5` – поиск в радиусе или по прямоугольнику (`min_latitude`, `max_latitude`, `min_longitude`, `max_longitude`)

Все ответы возвращаются в формате JSON.
